<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quy đổi điểm tuyển sinh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #E63946;
            --secondary-color: #C1121F;
            --light-bg: #FFF1F2;
            --success-color: #2A9D8F;
            --danger-color: #E63946;
            --warning-color: #F4A261;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #FFF1F2 0%, #FFE4E6 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff10" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,149.3C960,160,1056,160,1152,138.7C1248,117,1344,75,1392,53.3L1440,32L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            opacity: 0.1;
        }

        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(230, 57, 70, 0.15);
        }

        .form-control, .form-select {
            border-radius: 12px;
            padding: 12px;
            border: 2px solid #FFE4E6;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(230, 57, 70, 0.1);
        }

        .form-label {
            font-weight: 500;
            color: #4B5563;
            margin-bottom: 0.5rem;
        }

        .btn {
            border-radius: 12px;
            padding: 0.8rem 2rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 12px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-outline-success {
            border: 2px solid var(--success-color);
            color: var(--success-color);
        }

        .btn-outline-success:hover {
            background: var(--success-color);
            color: white;
            transform: translateY(-2px);
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.1);
            margin-top: 2rem;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-state {
            text-align: center;
            padding: 2rem;
        }

        .loading-state p {
            color: var(--primary-color);
            font-weight: 500;
            margin-top: 1rem;
        }

        .share-btn {
            background: linear-gradient(135deg, var(--success-color), #238B7E);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.8rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 157, 143, 0.3);
            color: white;
        }

        .info-text {
            color: #4B5563;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .table {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(230, 57, 70, 0.05);
        }

        .table thead th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem;
            font-weight: 500;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
            border-bottom: 1px solid #FFE4E6;
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .table tbody tr:hover {
            background-color: rgba(230, 57, 70, 0.05);
        }

        .alert {
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .alert-danger {
            background-color: #FFF1F2;
            border-color: #FECDD3;
            color: #BE123C;
        }

        .alert i {
            margin-right: 0.5rem;
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .shape {
            position: absolute;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            opacity: 0.05;
            border-radius: 50%;
        }

        .shape-1 {
            width: 300px;
            height: 300px;
            top: -150px;
            right: -150px;
        }

        .shape-2 {
            width: 200px;
            height: 200px;
            bottom: -100px;
            left: -100px;
        }

        .shape-3 {
            width: 150px;
            height: 150px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Modern Loading Animation */
        .modern-loader {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto;
        }

        .modern-loader div {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .modern-loader div:nth-child(1) {
            left: 8px;
            animation: modern-loader1 0.6s infinite;
        }

        .modern-loader div:nth-child(2) {
            left: 8px;
            animation: modern-loader2 0.6s infinite;
        }

        .modern-loader div:nth-child(3) {
            left: 32px;
            animation: modern-loader2 0.6s infinite;
        }

        .modern-loader div:nth-child(4) {
            left: 56px;
            animation: modern-loader3 0.6s infinite;
        }

        @keyframes modern-loader1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes modern-loader3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        @keyframes modern-loader2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        @media (max-width: 768px) {
            .header {
                padding: 2rem 0;
            }

            .card {
                margin: 0 1rem;
            }

            .btn-primary {
                width: 100%;
            }

            body, .container, .card, .form-label, .form-control, .form-select, .btn, .result-header h4, .result-summary, .benchmark-title, .benchmark-table, .benchmark-table th, .benchmark-table td, .score-status {
                font-size: 13px !important;
            }
            .header h1, .header .display-4 {
                font-size: 1.3rem !important;
            }
            .header p.lead {
                font-size: 1rem !important;
            }
            .form-label {
                font-size: 12px !important;
            }
            .form-control, .form-select {
                font-size: 13px !important;
                padding: 8px 10px;
            }
            .btn, .btn-primary, .btn-outline-primary, .btn-outline-success, .share-btn {
                font-size: 13px !important;
                padding: 0.6rem 1.2rem;
            }
            .result-header {
                padding: 1rem;
            }
            .result-summary {
                padding: 0.7rem;
                margin-bottom: 1rem;
            }
            .benchmark-title {
                font-size: 1rem !important;
                margin-bottom: 0.5rem;
            }
            .benchmark-card {
                padding: 1rem;
            }
            .benchmark-table th, .benchmark-table td {
                font-size: 12px !important;
                padding: 0.4rem 0.2rem;
            }
            .score-status {
                font-size: 12px !important;
                padding: 0.15rem 0.5rem;
            }
            .table-responsive, .benchmark-table {
                margin-bottom: 0.5rem;
            }
            .info-text {
                font-size: 12px !important;
            }
            .card-title, h4, h5 {
                font-size: 1rem !important;
            }
            .result-card {
                padding: 1rem;
            }
            .mt-4, .mb-4 {
                margin-top: 1rem !important;
                margin-bottom: 1rem !important;
            }

            /* Tối ưu bảng ngành cho mobile */
            .benchmark-table th:first-child,
            .benchmark-table td:first-child {
                display: none;
            }
            .benchmark-table th, .benchmark-table td {
                font-size: 13px;
                padding: 0.5rem 0.3rem;
            }
            .benchmark-table {
                font-size: 13px;
            }
            .benchmark-table th, .benchmark-table td {
                white-space: nowrap;
            }
            .benchmark-table {
                overflow-x: auto;
                display: block;
            }
        }

        /* Enhanced Result Display */
        .result-animation {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-row {
            animation: fadeInRow 0.5s ease-out;
            animation-fill-mode: both;
        }

        @keyframes fadeInRow {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .score-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .method-name {
            font-weight: 500;
            color: #4B5563;
        }

        .result-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            border-radius: 15px 15px 0 0;
            margin-bottom: 1rem;
        }

        .result-header h4 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .result-summary {
            background: #FFF1F2;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .result-summary p {
            margin: 0;
            color: #4B5563;
            font-size: 0.95rem;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(230, 57, 70, 0.05);
            transform: translateX(5px);
        }

        .table tbody tr td {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover td {
            color: var(--primary-color);
        }

        .share-btn {
            position: relative;
            overflow: hidden;
        }

        .share-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .share-btn:hover::after {
            width: 300px;
            height: 300px;
        }

        /* Chart Styles */
        .chart-container {
            position: relative;
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.1);
            height: 400px;
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #scoreChart {
            width: 100% !important;
            height: 100% !important;
        }

        .chart-title {
            color: var(--primary-color);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #4B5563;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .chart-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .chart-tab {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .chart-tab:hover {
            transform: translateY(-2px);
        }

        /* Benchmark Score Styles */
        .benchmark-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.1);
        }

        .benchmark-title {
            color: var(--primary-color);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .benchmark-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1rem;
        }

        .benchmark-table th,
        .benchmark-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #FFE4E6;
        }

        .benchmark-table th {
            background: #FFF1F2;
            font-weight: 600;
            color: #4B5563;
        }

        .benchmark-table tr:hover {
            background-color: rgba(230, 57, 70, 0.05);
        }

        .score-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .score-status.low {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .score-status.risky {
            background-color: #fef9c3;
            color: #b45309;
        }

        .score-status.safe {
            background-color: #d1fae5;
            color: #047857;
        }

        .score-status.very-safe {
            background-color: #10b981;
            color: #fff;
            font-weight: bold;
        }

        .search-box {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid #FFE4E6;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(230, 57, 70, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
        }
    </style>
    <script>
        ['keydown', 'keyup', 'keypress'].forEach(function(evt) {
            window.addEventListener(evt, function(e) {
                // F12
                if (e.key === 'F12') {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+Shift+I/J/C
                if (e.ctrlKey && e.shiftKey && ['I','J','C','i','j','c'].includes(e.key)) {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+U/S/P/C/V/X/A
                if (e.ctrlKey && ['U','S','P','C','V','X','A','u','s','p','c','v','x','a'].includes(e.key)) {
                    e.preventDefault();
                    return false;
                }
            });
        });
        window.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        window.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });
        window.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
    </script>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <div class="header text-center">
        <div class="container">
            <h1 class="display-4 mb-3 fw-bold">Quy đổi mức điểm giữa các phương thức</h1>
            <p class="lead mb-0">Tra cứu nhanh chóng và chính xác dựa trên phổ điểm 2024</p>
        </div>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body p-4">
                        <form id="conversionForm">
                            <div class="mb-4">
                                <label for="truong" class="form-label">
                                    <i class="fas fa-university me-2"></i>Chọn trường
                                </label>
                                <select class="form-select" id="truong" name="truong" required>
                                    <option value="">Đang tải danh sách các trường...</option>
                                </select>
                            </div>

                            <div class="mb-4" id="vnu-school-group" style="display:none;">
                                <label for="vnu-school" class="form-label">
                                    <i class="fas fa-building me-2"></i>Trường dự định xét tuyển
                                </label>
                                <select class="form-select" id="vnu-school" name="vnu-school">
                                    <option value="">Chọn trường thành viên</option>
                                    <option value="VNU-HUS">Trường Đại học Khoa học Tự nhiên (VNU-HUS)</option>
                                    <option value="VNU-USSH">Trường Đại học Khoa học Xã hội và Nhân văn (VNU-USSH)</option>
                                    <option value="VNU-ULIS">Trường Đại học Ngoại ngữ (VNU-ULIS)</option>
                                    <option value="VNU-UET">Trường Đại học Công nghệ (VNU-UET)</option>
                                    <option value="VNU-UEB">Trường Đại học Kinh tế (VNU-UEB)</option>
                                    <option value="VNU-UEd">Trường Đại học Giáo dục (VNU-UEd)</option>
                                    <option value="VNU-VJU">Trường Đại học Việt - Nhật (VNU-VJU)</option>
                                    <option value="VNU-UMP">Trường Đại học Y Dược (VNU-UMP)</option>
                                    <option value="VNU-UL">Trường Đại học Luật (VNU-UL)</option>
                                </select>
                            </div>

                            <div class="mb-4">
                                <label for="phuongthuc" class="form-label">
                                    <i class="fas fa-list-alt me-2"></i>Chọn phương thức xét tuyển
                                </label>
                                <select class="form-select" id="phuongthuc" name="phuongthuc" required disabled>
                                    <option value="">Vui lòng chọn trường...</option>
                                </select>
                            </div>

                            <div class="mb-4">
                                <label for="diem" class="form-label">
                                    <i class="fas fa-star me-2"></i>Nhập điểm (Điểm gốc trên bảng điểm)
                                </label>
                                <input type="number" class="form-control" id="diem" name="diem" 
                                       placeholder="Nhập điểm cần quy đổi" step="0.01" required>
                            </div>

                            <div class="mb-4" id="ccnn-group" style="display:none;">
                                <label for="ccnn" class="form-label">
                                    <i class="fas fa-certificate me-2"></i>Chứng chỉ ngoại ngữ (nếu có)
                                </label>
                                <select class="form-select" id="ccnn" name="ccnn">
                                    <option value="0">Không có</option>
                                    <option value="1">5.0</option>
                                    <option value="2">5.5</option>
                                    <option value="3">6.0</option>
                                    <option value="4">6.5</option>
                                    <option value="5">7.0</option>
                                    <option value="6">7.5</option>
                                    <option value="7">Từ 8.0 trở lên</option>
                                </select>
                            </div>

                            <div class="mb-4" id="diemvung-group" style="display:none;">
                                <label for="diemvung" class="form-label">
                                    <i class="fas fa-map-marker-alt me-2"></i>Điểm vùng (Thí sinh chọn theo trường THPT đang theo học)
                                </label>
                                <select class="form-select" id="diemvung" name="diemvung">
                                    <option value="0">Khu vực 3</option>
                                    <option value="2.5">Khu vực 1</option>
                                    <option value="0.83">Khu vực 2</option>
                                    <option value="1.67">Khu vực 2 - Nông Thôn</option>
                                </select>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-calculator me-2"></i>Tra cứu
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="resultCard" class="card result-card">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-chart-line me-2"></i>Kết quả quy đổi
                        </h4>
                        <div id="resultContent"></div>
                        <div class="text-center mt-4">
                            <button id="printBtn" class="share-btn">
                                <i class="fas fa-print me-2"></i>In kết quả
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>Thông tin bổ sung
                        </h5>
                        <p class="info-text">
                            Kết quả quy đổi được tính toán dựa trên phổ điểm năm 2024 và có thể thay đổi theo từng năm.
                            Để có thông tin chính xác nhất, vui lòng tham khảo thông tin từ trường đại học.
                        </p>
                        <div class="mt-3">
                            <a href="https://aeck.io.vn/rank/" target="_blank" rel="noopener" class="btn btn-outline-primary me-2">
                                <i class="fas fa-search me-2"></i>Tra cứu thứ hạng
                            </a>
                            <a href="#" target="_blank" rel="noopener" class="btn btn-outline-success">
                                <i class="fas fa-graduation-cap me-2"></i>Xuất phát sớm
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="width: 100%; text-align: center; margin: 40px 0 20px 0;">
        <img src="AECK.svg" alt="Thương hiệu" style="max-width: 340px; height: auto; opacity: 0.95;">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxbtIj7OMS6FK_o3PXWOvUrrypJocnFTFE0mVdq2z99jdMOe-Rkh1DLV4h2wuPT5fmK/exec";
        
        // Hàm chuyển chuỗi có dấu sang không dấu
        function toSlug(str) {
            return str.replace(/Đ/g, "D")
                    .replace(/đ/g, "d")
                    .normalize("NFD")
                    .replace(/[̀-ͯ]/g, "")
                    .replace(/[^a-zA-Z0-9]/g, "")
                    .toLowerCase();
        }

        // Lấy danh sách trường khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            const truongSelect = document.getElementById('truong');
            const phuongthucSelect = document.getElementById('phuongthuc');
            const diemInput = document.getElementById('diem');
            const ccnnGroup = document.getElementById('ccnn-group');
            const ccnnSelect = document.getElementById('ccnn');
            const diemvungGroup = document.getElementById('diemvung-group');
            const diemvungSelect = document.getElementById('diemvung');
            const form = document.getElementById('conversionForm');
            const resultCard = document.getElementById('resultCard');
            const resultContent = document.getElementById('resultContent');
            const printBtn = document.getElementById('printBtn');

            // Lấy danh sách trường
            fetch(`${API_URL}?action=getTruongs`)
                .then(res => res.json())
                .then(data => {
                    truongSelect.innerHTML = '<option value="">Chọn trường</option>';
                    data.forEach(truong => {
                        const option = document.createElement('option');
                        option.value = truong;
                        option.textContent = truong;
                        truongSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    truongSelect.innerHTML = '<option value="">Lỗi khi tải danh sách trường</option>';
                    console.error('Error:', error);
                });

            // Xử lý khi chọn trường
            truongSelect.addEventListener('change', function() {
                const truong = this.value;
                diemInput.value = '';
                phuongthucSelect.disabled = true;
                phuongthucSelect.innerHTML = '<option value="">Đang tải danh sách các phương thức quy đổi...</option>';
                
                // Hiển thị/ẩn select box trường VNU
                const vnuSchoolGroup = document.getElementById('vnu-school-group');
                if (truong.toLowerCase().includes('quốc gia hà nội')) {
                    vnuSchoolGroup.style.display = '';
                } else {
                    vnuSchoolGroup.style.display = 'none';
                    document.getElementById('vnu-school').value = '';
                }

                fetch(`${API_URL}?action=getPhuongThuc&truong=${encodeURIComponent(truong)}`)
                    .then(res => res.json())
                    .then(data => {
                        phuongthucSelect.innerHTML = '<option value="">Chọn phương thức xét tuyển</option>';
                        data.forEach(method => {
                            const option = document.createElement('option');
                            option.value = method;
                            option.textContent = method;
                            phuongthucSelect.appendChild(option);
                        });
                        phuongthucSelect.disabled = false;
                    })
                    .catch(error => {
                        phuongthucSelect.innerHTML = '<option value="">Lỗi khi tải phương thức</option>';
                        console.error('Error:', error);
                    });
            });

            // Xử lý khi chọn phương thức
            phuongthucSelect.addEventListener('change', function() {
                const methodValue = this.value.toLowerCase();
                const showExtra = (methodValue.includes('tsa') || methodValue.includes('đgtd') || methodValue.includes('dgtd')) && truongSelect.value.toLowerCase().includes('bách khoa');
                ccnnGroup.style.display = showExtra ? '' : 'none';
                diemvungGroup.style.display = showExtra ? '' : 'none';
                if (!showExtra) {
                    ccnnSelect.value = '0';
                    diemvungSelect.value = '0';
                }
            });

            // Xử lý form submit
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const truong = truongSelect.value;
                const method = phuongthucSelect.value;
                let score = parseFloat(diemInput.value);
                let bonus = 0;
                let vung = 0;
                // Nếu có input chứng chỉ và đang hiển thị, cộng điểm tương ứng
                if (ccnnGroup.style.display !== 'none') {
                    bonus = parseInt(ccnnSelect.value) || 0;
                }
                // Nếu có input điểm vùng và đang hiển thị, lấy điểm vùng
                if (diemvungGroup.style.display !== 'none') {
                    vung = parseFloat(diemvungSelect.value) || 0;
                }
                let tong = score + bonus;
                if (diemvungGroup.style.display !== 'none') {
                    if (tong < 75) {
                        tong = tong + vung;
                    } else {
                        tong = tong + (vung * (100 - tong) / 25);
                    }
                }
                score = Math.round(tong * 100) / 100;

                if (!truong || !method || isNaN(score)) {
                    alert('Vui lòng điền đầy đủ thông tin!');
                    return;
                }

                // Hiển thị loading
                resultCard.style.display = 'block';
                resultContent.innerHTML = `
                    <div class="loading-state">
                        <div class="modern-loader">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                        <p>Đang xử lý yêu cầu của bạn...</p>
                    </div>
                `;

                // Gọi API quy đổi điểm
                fetch(`${API_URL}?action=convertScore&truong=${encodeURIComponent(truong)}&method=${encodeURIComponent(method)}&score=${score}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) {
                            resultContent.innerHTML = `
                                <div class="alert alert-danger">
                                    <i class="fas fa-exclamation-circle me-2"></i>${data.error}
                                </div>
                            `;
                            return;
                        }

                        // Tạo bảng kết quả
                        let html = `
                            <div class="result-animation">
                                <div class="result-header">
                                    <h4><i class="fas fa-chart-line me-2"></i>Kết quả quy đổi điểm</h4>
                                </div>
                                <div class="result-summary">
                                    <p><i class="fas fa-info-circle me-2"></i>Điểm ${score} của phương thức ${method} được quy đổi sang các phương thức khác như sau:</p>
                                </div>

                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Phương thức</th>
                                                <th class="text-end">Điểm tương đương</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                        `;

                        let delay = 0;
                        for (let key in data) {
                            html += `
                                <tr class="result-row" style="animation-delay: ${delay}s">
                                    <td class="method-name">${key}</td>
                                    <td class="text-end"><span class="score-value">${data[key]}</span></td>
                                </tr>
                            `;
                            delay += 0.1;
                        }

                        html += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `;

                        // Gợi ý ngành dựa trên điểm THPT thang 30 trong output
                        let suggestScore = null;
                        let thpt30Key = Object.keys(data).find(k => k.toLowerCase().includes('thpt') && k.includes('30'));
                        if (thpt30Key) {
                            suggestScore = parseFloat(data[thpt30Key]);
                        } else if (method.toLowerCase().includes('thpt')) {
                            suggestScore = parseFloat(score);
                        }
                        if (!isNaN(suggestScore)) {
                            const suggestedMajors = benchmarkData
                                .filter(item => (suggestScore - item.diem_thpt_2024) >= -0.4)
                                .sort((a, b) => b.diem_thpt_2024 - a.diem_thpt_2024);
                            if (suggestedMajors.length > 0) {
                                html += `
                                    <div class="benchmark-card mt-4">
                                        <div class="benchmark-title">
                                            <i class="fas fa-lightbulb me-2"></i>Gợi ý ngành phù hợp với điểm của bạn (Số liệu điểm chuẩn năm 2024)
                                        </div>
                                        <div class="result-summary">
                                            <p><i class="fas fa-info-circle me-2"></i>Với điểm THPT <b>${suggestScore}</b>, bạn có thể xét tuyển vào các ngành sau của Đại học Bách Khoa Hà Nội:</p>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="benchmark-table">
                                                <thead>
                                                    <tr>
                                                        <th>Ngành</th>
                                                        <th>Mã ngành</th>
                                                        <th>Điểm chuẩn THPT 2024</th>
                                                        <th>Điểm của bạn</th>
                                                        <th>Đánh giá</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                `;
                                suggestedMajors.forEach(item => {
                                    const status = getAdmissionStatus(suggestScore, item.diem_thpt_2024);
                                    html += `
                                        <tr>
                                            <td>${item.major}</td>
                                            <td>${item.code}</td>
                                            <td>${item.diem_thpt_2024}</td>
                                            <td>${suggestScore}</td>
                                            <td><span class="score-status ${status.class}">${status.text}</span></td>
                                        </tr>
                                    `;
                                });
                                html += `
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                `;
                            } else {
                                html += `
                                    <div class="benchmark-card mt-4">
                                        <div class="benchmark-title">
                                            <i class="fas fa-lightbulb me-2"></i>Gợi ý ngành phù hợp với điểm THPT 2024 của bạn
                                        </div>
                                        <div class="result-summary">
                                            <p><i class="fas fa-info-circle me-2"></i>Rất tiếc, hiện không có ngành nào phù hợp với điểm THPT của bạn.</p>
                                        </div>
                                    </div>
                                `;
                            }
                        }

                        // Dữ liệu ngành UET
                        const uetMajors = [
                            { code: 'CN1', name: 'Công nghệ thông tin', tohop: 'A00; A01; D01', diem: 27.8 },
                            { code: 'CN10', name: 'Công nghệ nông nghiệp', tohop: 'A00; A01; B00', diem: 22.5 },
                            { code: 'CN11', name: 'Kỹ thuật điều khiển và tự động hoá', tohop: 'A00; A01; D01', diem: 27.05 },
                            { code: 'CN12', name: 'Trí tuệ nhân tạo', tohop: 'A00; A01; D01', diem: 27.12 },
                            { code: 'CN13', name: 'Kỹ thuật năng lượng', tohop: 'A00; A01; D01', diem: 24.59 },
                            { code: 'CN14', name: 'Hệ thống thông tin', tohop: 'A00; A01; D01', diem: 26.87 },
                            { code: 'CN15', name: 'Mạng máy tính và truyền thông dữ liệu', tohop: 'A00; A01; D01', diem: 26.92 },
                            { code: 'CN17', name: 'Kỹ thuật Robot', tohop: 'A00; A01; D01', diem: 25.99 },
                            { code: 'CN18', name: 'Thiết kế công nghiệp và đồ họa', tohop: 'A00; A01; D01', diem: 24.64 },
                            { code: 'CN2', name: 'Kỹ thuật máy tính', tohop: 'A00; A01; D01', diem: 26.97 },
                            { code: 'CN3', name: 'Vật lý kỹ thuật', tohop: 'A00; A01; D01', diem: 25.24 },
                            { code: 'CN4', name: 'Cơ kỹ thuật', tohop: 'A00; A01; D01', diem: 26.03 },
                            { code: 'CN5', name: 'Công nghệ kỹ thuật xây dựng', tohop: 'A00; A01; D01', diem: 23.91 },
                            { code: 'CN6', name: 'Công nghệ kỹ thuật cơ – điện tử', tohop: 'A00; A01; D01', diem: 26.27 },
                            { code: 'CN7', name: 'Công nghệ hàng không vũ trụ', tohop: 'A00; A01; D01', diem: 24.61 },
                            { code: 'CN8', name: 'Khoa học máy tính', tohop: 'A00; A01; D01', diem: 27.58 },
                            { code: 'CN9', name: 'Công nghệ kỹ thuật điện tử – viễn thông', tohop: 'A00; A01; D01', diem: 26.3 }
                        ];

                        // Tìm điểm THPT cao nhất trong các khối A00, A01, D01 từ output
                        let maxBlockScore = null;
                        let maxBlockName = '';
                        if (truongSelect.value.toLowerCase().includes('quốc gia hà nội') && document.getElementById('vnu-school').value === 'VNU-UET') {
                            const blockNames = ['A00', 'A01', 'D01'];
                            for (const block of blockNames) {
                                const key = Object.keys(data).find(k => k.toUpperCase().includes(block));
                                if (key && !isNaN(parseFloat(data[key]))) {
                                    const val = parseFloat(data[key]);
                                    if (maxBlockScore === null || val > maxBlockScore) {
                                        maxBlockScore = val;
                                        maxBlockName = block;
                                    }
                                }
                            }
                        }

                        // Hàm render bảng ngành UET
                        function renderUetMajorTable(userScore, blockName) {
                            const sortedMajors = [...uetMajors].sort((a, b) => b.diem - a.diem);
                            let html = `<div class="benchmark-card mt-4">
                                <div class="benchmark-title">
                                    <i class="fas fa-lightbulb me-2"></i>Gợi ý ngành phù hợp với điểm của bạn (Trường Đại học Công nghệ - ĐHQGHN)
                                </div>
                                <div class="table-responsive">
                                    <table class="benchmark-table">
                                        <thead>
                                            <tr>
                                                <th>Mã ngành</th>
                                                <th>Tên ngành</th>
                                                <th>Tổ hợp môn</th>
                                                <th>Điểm chuẩn 2024</th>
                                                <th>Điểm của bạn</th>
                                                <th>Đánh giá</th>
                                            </tr>
                                        </thead>
                                        <tbody>`;
                            sortedMajors.forEach(item => {
                                const status = getAdmissionStatus(userScore, item.diem);
                                html += `<tr>
                                    <td>${item.code}</td>
                                    <td>${item.name}</td>
                                    <td>${item.tohop}</td>
                                    <td>${item.diem}</td>
                                    <td>${(userScore !== null && userScore !== undefined && !isNaN(userScore)) ? userScore + (blockName ? ' (' + blockName + ')' : '') : ''}</td>
                                    <td><span class="score-status ${status.class}">${status.text}</span></td>
                                </tr>`;
                            });
                            html += `</tbody></table></div></div>`;
                            return html;
                        }

                        // Thêm vào sau khi có suggestScore (điểm THPT)
                        let showUetMajorTable = (
                            truongSelect.value.toLowerCase().includes('quốc gia hà nội') &&
                            document.getElementById('vnu-school').value === 'VNU-UET' &&
                            maxBlockScore !== null
                        );

                        if (showUetMajorTable) {
                            html += renderUetMajorTable(maxBlockScore, maxBlockName);
                        } else {
                            // Gợi ý ngành chung như cũ
                            // Tạo bảng kết quả
                            html = `
                                <div class="result-animation">
                                    <div class="result-header">
                                        <h4><i class="fas fa-chart-line me-2"></i>Kết quả quy đổi điểm</h4>
                                    </div>
                                    <div class="result-summary">
                                        <p><i class="fas fa-info-circle me-2"></i>Điểm ${score} của phương thức ${method} được quy đổi sang các phương thức khác như sau:</p>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Phương thức</th>
                                                    <th class="text-end">Điểm tương đương</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                            `;

                            let delay = 0;
                            for (let key in data) {
                                html += `
                                    <tr class="result-row" style="animation-delay: ${delay}s">
                                        <td class="method-name">${key}</td>
                                        <td class="text-end"><span class="score-value">${data[key]}</span></td>
                                    </tr>
                                `;
                                delay += 0.1;
                            }

                            html += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            `;

                            // Gợi ý ngành chung (benchmarkData)
                            let suggestScore = null;
                            let thpt30Key = Object.keys(data).find(k => k.toLowerCase().includes('thpt') && k.includes('30'));
                            if (thpt30Key) {
                                suggestScore = parseFloat(data[thpt30Key]);
                            } else if (method.toLowerCase().includes('thpt')) {
                                suggestScore = parseFloat(score);
                            }
                            if (!isNaN(suggestScore)) {
                                const suggestedMajors = benchmarkData
                                    .filter(item => (suggestScore - item.diem_thpt_2024) >= -0.4)
                                    .sort((a, b) => b.diem_thpt_2024 - a.diem_thpt_2024);
                                if (suggestedMajors.length > 0) {
                                    html += `
                                        <div class="benchmark-card mt-4">
                                            <div class="benchmark-title">
                                                <i class="fas fa-lightbulb me-2"></i>Gợi ý ngành phù hợp với điểm của bạn (Số liệu điểm chuẩn năm 2024)
                                            </div>
                                            <div class="result-summary">
                                                <p><i class="fas fa-info-circle me-2"></i>Với điểm THPT <b>${suggestScore}</b>, bạn có thể xét tuyển vào các ngành sau của Đại học Bách Khoa Hà Nội:</p>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="benchmark-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Ngành</th>
                                                            <th>Mã ngành</th>
                                                            <th>Điểm chuẩn THPT 2024</th>
                                                            <th>Điểm của bạn</th>
                                                            <th>Đánh giá</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                    `;
                                    suggestedMajors.forEach(item => {
                                        const status = getAdmissionStatus(suggestScore, item.diem_thpt_2024);
                                        html += `
                                            <tr>
                                                <td>${item.major}</td>
                                                <td>${item.code}</td>
                                                <td>${item.diem_thpt_2024}</td>
                                                <td>${suggestScore}</td>
                                                <td><span class="score-status ${status.class}">${status.text}</span></td>
                                            </tr>
                                        `;
                                    });
                                    html += `
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    html += `
                                        <div class="benchmark-card mt-4">
                                            <div class="benchmark-title">
                                                <i class="fas fa-lightbulb me-2"></i>Gợi ý ngành phù hợp với điểm THPT 2024 của bạn
                                            </div>
                                            <div class="result-summary">
                                                <p><i class="fas fa-info-circle me-2"></i>Rất tiếc, hiện không có ngành nào phù hợp với điểm THPT của bạn.</p>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
                        }

                        resultContent.innerHTML = html;

                        // Cập nhật sự kiện in kết quả
                        printBtn.onclick = function() {
                            window.print();
                        };
                    })
                    .catch(error => {
                        resultContent.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-circle me-2"></i>Lỗi khi xử lý dữ liệu. Vui lòng thử lại sau.
                            </div>
                        `;
                        console.error('Error:', error);
                    });
            });

            // Xử lý URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const truongParam = urlParams.get('truong');
            const methodParam = urlParams.get('phuongthuc');
            const scoreParam = urlParams.get('diem');

            if (truongParam) {
                truongSelect.value = truongParam;
                truongSelect.dispatchEvent(new Event('change'));
            }

            if (methodParam && phuongthucSelect) {
                for (let option of phuongthucSelect.options) {
                    if (toSlug(option.textContent) === methodParam.toLowerCase()) {
                        phuongthucSelect.value = option.value;
                        break;
                    }
                }
            }

            if (scoreParam) {
                diemInput.value = decodeURIComponent(scoreParam);
            }

            if (truongParam && methodParam && scoreParam) {
                form.dispatchEvent(new Event('submit'));
            }
        });

        // Add the benchmark data and functions
        const benchmarkData = [
            { major: "Kỹ thuật Sinh học", code: "BF1", diem_thpt_2024: 24.00 },
            { major: "Kỹ thuật Thực phẩm", code: "BF2", diem_thpt_2024: 24.54 },
            { major: "Kỹ thuật Thực phẩm (CT tiên tiến)", code: "BF-E12", diem_thpt_2024: 22.00 },
            { major: "Kỹ thuật sinh học (CT tiên tiến)", code: "BF-E19", diem_thpt_2024: 22.00 },
            { major: "Kỹ thuật Hóa học", code: "CH1", diem_thpt_2024: 24.38 },
            { major: "Hóa học", code: "CH2", diem_thpt_2024: 23.81 },
            { major: "Công nghệ Giáo dục", code: "ED2", diem_thpt_2024: 25.30 },
            { major: "Quản lý giáo dục", code: "ED3", diem_thpt_2024: 24.78 },
            { major: "Kỹ thuật điện", code: "EE1", diem_thpt_2024: 26.81 },
            { major: "Kỹ thuật điều khiển & Tự động hóa", code: "EE2", diem_thpt_2024: 28.16 },
            { major: "Hệ thống điện và năng lượng tái tạo (CT tiên tiến)", code: "EE-E18", diem_thpt_2024: 25.80 },
            { major: "Kỹ thuật Điều khiển - Tự động hoá (CT tiên tiến)", code: "EE-E8", diem_thpt_2024: 27.54 },
            { major: "Tin học công nghiệp và Tự động hóa (CT Việt - Pháp PFIEV)", code: "EE-EP", diem_thpt_2024: 26.22 },
            { major: "Quản lý Năng lượng", code: "EM1", diem_thpt_2024: 25.40 },
            { major: "Quản lý Công nghiệp", code: "EM2", diem_thpt_2024: 25.60 },
            { major: "Quản trị Kinh doanh", code: "EM3", diem_thpt_2024: 25.77 },
            { major: "Kế toán", code: "EM4", diem_thpt_2024: 25.80 },
            { major: "Tài chính-Ngân hàng", code: "EM5", diem_thpt_2024: 25.91 },
            { major: "Phân tích kinh doanh (CT tiên tiến)", code: "EM-E13", diem_thpt_2024: 25.50 },
            { major: "Logistics và Quản lý chuỗi cung ứng (CT tiên tiến)", code: "EM-E14", diem_thpt_2024: 26.06 },
            { major: "Kỹ thuật Điện tử-Viễn thông", code: "ET1", diem_thpt_2024: 27.41 },
            { major: "Kỹ thuật Y sinh", code: "ET2", diem_thpt_2024: 25.80 },
            { major: "Truyền thông số và Kỹ thuật đa phương tiện (CT tiên tiến)", code: "ET-E16", diem_thpt_2024: 26.61 },
            { major: "Kỹ thuật Điện tử - Viễn thông (CT tiên tiến)", code: "ET-E4", diem_thpt_2024: 27.03 },
            { major: "Kỹ thuật Y sinh (CT tiên tiến)", code: "ET-E5", diem_thpt_2024: 25.08 },
            { major: "Hệ thống nhúng thông minh và IoT (CT tiên tiến)", code: "ET-E9", diem_thpt_2024: 27.21 },
            { major: "Điện tử - Viễn thông - ĐH Leibniz Hannover (CHLB Đức)", code: "ET-LUH", diem_thpt_2024: 25.65 },
            { major: "Kỹ thuật Môi trường", code: "EV1", diem_thpt_2024: 22.10 },
            { major: "Quản lý Tài nguyên và Môi trường", code: "EV2", diem_thpt_2024: 21.78 },
            { major: "Tiếng Anh KHKT và Công nghệ", code: "FL1", diem_thpt_2024: 25.00 },
            { major: "Tiếng Anh chuyên nghiệp quốc tế", code: "FL2", diem_thpt_2024: 23.81 },
            { major: "Kỹ thuật Nhiệt", code: "HE1", diem_thpt_2024: 25.20 },
            { major: "CNTT: Khoa học Máy tính", code: "IT1", diem_thpt_2024: 28.53 },
            { major: "CNTT: Kỹ thuật Máy tính", code: "IT2", diem_thpt_2024: 28.48 },
            { major: "Khoa học dữ liệu và Trí tuệ nhân tạo (CT tiên tiến)", code: "IT-E10", diem_thpt_2024: 28.22 },
            { major: "An toàn không gian số - Cyber security (CT tiên tiến)", code: "IT-E15", diem_thpt_2024: 27.90 },
            { major: "Công nghệ Thông tin Việt – Nhật (CT tiên tiến)", code: "IT-E6", diem_thpt_2024: 27.35 },
            { major: "Công nghệ Thông tin Global ICT (CT tiên tiến)", code: "IT-E7", diem_thpt_2024: 28.01 },
            { major: "Công nghệ Thông tin Việt-Pháp (CT tiên tiến)", code: "IT-EP", diem_thpt_2024: 27.35 },
            { major: "Kỹ thuật Cơ điện tử", code: "ME1", diem_thpt_2024: 27.49 },
            { major: "Kỹ thuật Cơ khí", code: "ME2", diem_thpt_2024: 25.80 },
            { major: "Kỹ thuật Cơ điện tử (CT tiên tiến)", code: "ME-E1", diem_thpt_2024: 26.38 },
            { major: "Cơ khí Chế tạo máy – hợp tác với trường ĐH Griffith (Úc)", code: "ME-GU", diem_thpt_2024: 24.89 },
            { major: "Cơ điện tử - hợp tác với ĐH Leibniz Hannover (CHLB Đức)", code: "ME-LUH", diem_thpt_2024: 25.24 },
            { major: "Cơ điện tử - hợp tác với ĐHCN Nagaoka (Nhật Bản)", code: "ME-NUT", diem_thpt_2024: 25.11 },
            { major: "Toán-Tin", code: "MI1", diem_thpt_2024: 27.35 },
            { major: "Hệ thống Thông tin quản lý", code: "MI2", diem_thpt_2024: 27.34 },
            { major: "Kỹ thuật Vật liệu", code: "MS1", diem_thpt_2024: 24.90 },
            { major: "Kỹ thuật Vi điện tử và Công nghệ nano", code: "MS2", diem_thpt_2024: 27.64 },
            { major: "Công nghệ vật liệu Polyme và Compozit", code: "MS3", diem_thpt_2024: 25.00 },
            { major: "Khoa học và Kỹ thuật Vật liệu (CT tiên tiến)", code: "MS-E3", diem_thpt_2024: 24.00 },
            { major: "Kỹ thuật In", code: "MS5", diem_thpt_2024: 24.00 },
            { major: "Vật lý Kỹ thuật", code: "PH1", diem_thpt_2024: 25.87 },
            { major: "Kỹ thuật Hạt nhân", code: "PH2", diem_thpt_2024: 24.64 },
            { major: "Vật lý Y khoa", code: "PH3", diem_thpt_2024: 25.31 },
            { major: "Kỹ thuật Ô tô", code: "TE1", diem_thpt_2024: 26.99 },
            { major: "Kỹ thuật Cơ khí động lực", code: "TE2", diem_thpt_2024: 26.12 },
            { major: "Kỹ thuật Hàng không", code: "TE3", diem_thpt_2024: 26.22 },
            { major: "Kỹ thuật Ô tô (CT tiên tiến)", code: "TE-E2", diem_thpt_2024: 25.90 },
            { major: "Cơ khí hàng không (CT Việt - Pháp PFIEV)", code: "TE-EP", diem_thpt_2024: 24.86 },
            { major: "Quản trị Kinh doanh - ĐH Troy (Hoa Kỳ)", code: "TROY-BA", diem_thpt_2024: 21.00 },
            { major: "Khoa học Máy tính - ĐH Troy (Hoa Kỳ)", code: "TROY-IT", diem_thpt_2024: 21.00 },
            { major: "Công nghệ Dệt May", code: "TX1", diem_thpt_2024: 22.50 }
        ];

        function getAdmissionStatus(userScore, benchmarkScore) {
            const diff = userScore - benchmarkScore;
            if (diff >= 1.5) return { class: 'very-safe', text: 'Rất an toàn' };
            if (diff >= 0.8) return { class: 'safe', text: 'An toàn' };
            if (diff >= -0.1) return { class: 'risky', text: 'Có cơ hội' };
            return { class: 'low', text: 'Cơ hội thấp' };
        }

        function updateBenchmarkTable(userScore, searchTerm = '') {
            const tbody = document.getElementById('benchmarkTableBody');
            tbody.innerHTML = '';

            const filteredData = benchmarkData.filter(item => 
                item.major.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.code.toLowerCase().includes(searchTerm.toLowerCase())
            );

            filteredData.forEach(item => {
                const status = getAdmissionStatus(userScore, item.diem_thpt_2024);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.major}</td>
                    <td>${item.code}</td>
                    <td>${item.diem_thpt_2024}</td>
                    <td>${userScore}</td>
                    <td><span class="score-status ${status.class}">${status.text}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Add search functionality
        document.getElementById('majorSearch').addEventListener('input', function(e) {
            const userScore = parseFloat(diemInput.value);
            if (!isNaN(userScore)) {
                updateBenchmarkTable(userScore, e.target.value);
            }
        });

        // Update benchmark table when form is submitted
        form.addEventListener('submit', function(e) {
            // ... existing form submit code ...
            
            // After getting the converted score, update benchmark table
            fetch(`${API_URL}?action=convertScore&truong=${encodeURIComponent(truong)}&method=${encodeURIComponent(method)}&score=${score}`)
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        // ... existing error handling ...
                        return;
                    }

                    // ... existing result table generation ...

                    // Update benchmark table with the converted score
                    const convertedScore = parseFloat(data[method]);
                    if (!isNaN(convertedScore)) {
                        updateBenchmarkTable(convertedScore);
                    }
                })
                .catch(error => {
                    // ... existing error handling ...
                });
        });
    </script>
</body>
</html> 